<html>
<head>
  <title>Title</title>
  <style>
    .error {
      color: darkred;
    }

    .success {
      color: seagreen;
    }

    /*.form-control.success{*/
    /*  color: seagreen;*/
    /*}*/
    /*.form-control.success input {*/
    /*  border-color: seagreen;*/
    /*}*/

  </style>
</head>
<body>
<main class="container">
  <!--  ğŸíŒŒì¼ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡í•˜ë ¤ë©´ form ì˜ enctype-->
  <!--  default : form ì€ ë¬¸ìì—´ íŒŒë¼ë¯¸í„°ë§Œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§(== x-www-form-urlencoded/enctype="application/x-www-form-urlencode)ìœ¼ë¡œ ì „ì†¡ (íŒŒì¼ì€ ë¬´ì‹œ. íŒŒì¼ ì´ë¦„ë§Œ ì „ì†¡)-->
  <!--  => íšŒì›ê°€ì… ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì „ì†¡ì„ í•˜ë©´ ë¬¸ìì—´ ì´ ì „ì†¡ëœë‹¤.-->
  <!--  multipart/form-data : formì˜ ëª¨ë“  ë°ì´í„°ë¥¼ blob ë°”ì´ë„ˆë¦¬ í˜•ì‹ìœ¼ë¡œ ì „ì†¡ (file == BLOB)-->
  <!--  => íšŒì›ê°€ì… ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì „ì†¡ì„ í•˜ë©´ null ì´ ì „ì†¡ëœë‹¤.-->

  <!--  í†°ìº£ ì„œë¸”ë¦¿ : multipart/form-data ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ì–´ì„œ cos.jar ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆì–´ì•¼í•œë‹¤.-->
  <!--  => ğŸí†°ìº£ 7(ì„œë¸”ë¦¿ 3.0)ì´ìƒë¶€í„°ëŠ” @MultipartConfig ë¥¼ ì‚¬ìš©-->
  <!-- ğŸì…ë ¥ì°½ì— ìë™ì…ë ¥ì´ ë˜ëŠ”ê²½ìš° - í¬ë¡¬ë¸Œë¼ìš°ì € ìë™ì™„ì„±ê¸°ëŠ¥ ë„ê¸° -->
  <form name="signupForm" action="./signup.do" method="post">
    <h1 class="my-4">íšŒì›ê°€ì…</h1>
    <p class="form-floating">
      <label class="valid-feedback">ì•„ì´ë””</label>
      <input id="uIdInput" type="text" name="uId" value="" class="form-control is-valid">
    <p id="idMsg"></p>
    </p>
    <p class="form-floating">
      <label>ì´ë¦„</label>
      <input id="unameInput" type="text" name="name" value="" class="">
    <p id="nameMsg"></p>
    </p>
    <p class="form-floating">
      <label>íŒ¨ìŠ¤ì›Œë“œ</label>
      <input id="pwInput" type="password" name="pw" value="" class="">
    <p id="pwMsg"></p>
    </p>
    <p class="form-floating">
      <label>íŒ¨ìŠ¤ì›Œë“œ ì²´í¬</label>
      <input id="cpwInput" type="password" name="check_pw" value="" class="form-control">
    <p id="cpwMsg"></p>
    </p>
    <p class="input-group">
      <label class="input-group-text">í”„ë¡œí•„</label>
      <input type="file" name="img_path" value="" class="form-control">
    </p>
    <p class="form-floating">
      <label>í•¸ë“œí°</label>
      <input type="text" name="phone" value="" class="form-control">
    <p id="phoneMsg"></p>
    </p>
    <p class="form-floating">
      <label>ì´ë©”ì¼</label>
      <input type="text" name="email" value="" class="form-control">
    <p id="emailMsg"></p>
    </p>
    <p class="form-floating">
      <label>ìƒì¼</label>
      <input type="date" name="birth" value="" class="form-control">
    <p id="birthMsg"></p>
    </p>
    <p class="form-floating">
      <label>ì„±ë³„</label>
      <select name="gender" class="form-control">
        <option value="MALE" >ë‚¨ì</option>
        <option value="FEMALE" >ì—¬ì</option>
        <option value="NONE" selected>ì—†ìŒ</option>
      </select>
    </p>

    <p class="form-floating">
      <label>ì£¼ì†Œ</label>
      <input type="text" name="address" value="" class="form-control">
    <p id="addMsg"></p>
    </p>

    <p class="form-floating">
      <label>ì£¼ì†Œìƒì„¸</label>
      <input type="text" name="detail_address" value="" class="form-control">
    <p id="detailAddMsg"></p>
    </p>

    <p class="text-end">
      <button class="btn btn-outline-warning" type="reset">ì´ˆê¸°í™”</button>
      <button class="btn btn-outline-primary">ë“±ë¡</button>
    </p>
  </form>


  <script>
    const signupForm=document.forms["signupForm"];
    signupForm.uId.addEventListener("change",uIdHandler); // change ì´ë²¤íŠ¸(ì…ë ¥í›„ ë§ˆìš°ìŠ¤ ë°”ê¹¥ì„ í´ë¦­)ê°€ ë°œìƒí•˜ë©´ uIdHandler í•¨ìˆ˜ ì‹¤í–‰ // name ì„ í•„ë“œë¡œ ì“¸ìˆ˜ìˆë‹¤.
    signupForm.name.addEventListener("change",unameCheck);
    signupForm.pw.addEventListener("change",upwCheck);
    signupForm.check_pw.addEventListener("change",ucpwCheck);
    signupForm.birth.addEventListener("change",birthCheck);
    signupForm.phone.addEventListener("change",uphoneCheck);
    signupForm.email.addEventListener("change",uemailCheck);

    signupForm.onsubmit=async function(e){ // async ì‚¬ìš© - ì½œë°±í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì‹¤í–‰ì´ë¼ì„œ. await ë¥¼ ì´ìš©í•´ ë™ê¸°ì‹¤í–‰
      e.preventDefault(); // ë²„íŠ¼ ì†¡ì‹ ë§‰ëŠ”ë‹¤.
      let uIdCheck=await uIdHandler(); // í•¨ìˆ˜ í˜¸ì¶œ
      let nameCheck=unameCheck();
      let pwCheck=upwCheck();
      let checkPw=ucpwCheck();
      let btCheck=birthCheck();
      let phoneCheck=uphoneCheck();
      let emailCheck=uemailCheck();

      if(uIdCheck && nameCheck && pwCheck && checkPw && btCheck && phoneCheck && emailCheck) {
        signupForm.submit();
      }

      // if(!uIdCheck){ // uIdCheck ê°€ false ì¸ê²½ìš°
      //   window.location.href="#uIdInput"; // #ìœ¼ë¡œ ì“°ë©´ = í–ˆì„ë•Œ url ì˜ ë’¤ì— ë¶™ëŠ”ë‹¤. (+ ë”í•˜ê¸° ì•ˆí•´ë„.. ì›ë¦¬ëŠ” ëª¨ë¥´ê² ì§€ë§Œ)
      // }else if(!nameCheck){
      //   window.location.href="#unameInput";
      // }else if(!pwCheck){
      //   window.location.href="#pwInput";
      // }else if(!checkPw){
      //   window.location.href="#cpwInput";
      // }else{
      //   signupForm.submit();
      // }

    }
    // ğŸAJAX ë¹„ë™ê¸° í†µì‹  : fetch(í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜) => async await í•¨ìˆ˜ë¡œ ë¹„ë™ê¸°ì‹¤í–‰->ë™ê¸°ì‹¤í–‰
    async function uIdHandler(){
      let uId=signupForm.uId.value;
      let url="./idCheck.do?uId="+uId; // ì£¼ì†Œë¡œ ê²€ìƒ‰í•´ì„œ ê²°ê³¼ ë°›ê¸°
      // ./ ì  ìŠ¬ëŸ¬ì‹œë¼ëŠ” ê²ƒì€ ì „ì²´ url ì—ì„œ ë’¤ì—ì„œ ì²«ë²ˆì§¸ / ìŠ¬ëŸ¬ì‹œì˜ ì£¼ì†Œë¥¼ signup.do => idCheck.do?uId="+uId ë¡œ ë°”ê¾¸ê² ë‹¤.
      // ./ == /signup.do
      // ../ == /users/signup.do
      // ../../ == í•œì¹¸ ë” ë’¤ë¡œ ê°€ê³  ì‹¶ìœ¼ë©´
      // localhost:8080/ ì— ê°€ê³ ì‹¶ìœ¼ë©´ == "/" /idCheck.do  => localhost:8080/idCheck.do
      // í˜„ì¬íŒŒì¼ signup.jsp ì˜ url ì£¼ì†Œ : localhost:8080/webAppBoard/users/signup.do
      // let url => localhost:8080:webAppBoard/users/idCheck.do?uId="+uId
      const res=await fetch(url); // ì²«ë²ˆì§¸ ì½œë°±í•¨ìˆ˜ì˜ then ë°˜í™˜
      if(res.status==200){
        const obj=await res.json(); // {idCheck:true/false} // json ë¬¸ìì—´ì„ ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜
        if(obj.idCheck) { // ì´ë¯¸ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë”” // true
          idMsg.innerText="ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
          idMsg.classList.add("error");
          idMsg.classList.remove("success");
          return false;
        }else if(uId && uId.trim().length>1){ // ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””
          idMsg.innerText="ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
          idMsg.classList.add("success");
          idMsg.classList.remove("error");
          return true;
        }else if(!uId){
          idMsg.innerText="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
          idMsg.classList.add("error");
          idMsg.classList.remove("success");
          return false;
        }else {
          idMsg.innerText="ì•„ì´ë”” 2ê¸€ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”!";
          idMsg.classList.add("error");
          idMsg.classList.remove("success");
          return false;
        }
      }else {
        alert("ì˜¤ë¥˜ :" + res.status);
      }
    }

    function unameCheck(){
      let name=signupForm.name.value;
      if(name && name.trim().length>1){
        nameMsg.innerText="ì‚¬ìš©ê°€ëŠ¥í•œ ì´ë¦„";
        nameMsg.classList.add("success");
        nameMsg.classList.remove("error");
        return true;
      }else if(!name){
        nameMsg.innerText="ì´ë¦„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        nameMsg.classList.add("error");
        nameMsg.classList.remove("success");
        return false;
      }
      else{
        nameMsg.innerText = "ì´ë¦„ì€ 2ê¸€ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”!";
        nameMsg.classList.add("error");
        nameMsg.classList.remove("success");
        return false;
      }
    }

    function upwCheck(){
      let pw=signupForm.pw.value; // ì™€... ë¬´ì¡°ê±´ í•¨ìˆ˜ì•ˆì— ë³€ìˆ˜ì„ ì–¸ë˜ì–´ì•¼í•œë‹¤. í•¨ìˆ˜ë°”ê¹¥ì— ì„ ì–¸ì‹œ í•¨ìˆ˜ ì ìš©ì•ˆë¨
      if(!pw){
        pwMsg.innerText="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        pwMsg.classList.add("error");
        pwMsg.classList.remove("success");
        return false;
      }else if(pw && pw.trim().length>1){
        pwMsg.innerText="ì‚¬ìš©ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸";
        pwMsg.classList.add("success");
        pwMsg.classList.remove("error");
        return true;
      }else{
        pwMsg.innerText="ë¹„ë°€ë²ˆí˜¸ 2ê¸€ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”!";
        pwMsg.classList.add("error");
        pwMsg.classList.remove("success");
        return false;
      }
    }

    function ucpwCheck(){
      let cpw=signupForm.check_pw.value;
      let pw=signupForm.pw.value;
      if(pw){
        if(pw!==cpw){
          cpwMsg.innerText="ì…ë ¥í•œ ë‘ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          cpwMsg.classList.add("error");
          cpwMsg.classList.remove("success");
          return false;
        }else {
          cpwMsg.innerText="ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜";
          cpwMsg.classList.add("success");
          cpwMsg.classList.remove("error");
          return true;
        }
      }
    }


    function birthCheck(){
      let birth=signupForm.birth.value;
      if(!birth) {
        birthMsg.innerText = "ìƒì¼ì„ ì„ íƒí•˜ì„¸ìš”";
        birthMsg.classList.add("error");
        birthMsg.classList.remove("success");
        return false;
      }else{
        birthMsg.innerText="";
        birthMsg.classList.remove("error");
        return true;
      }
    }

    function uphoneCheck(){ // ì„ ì–¸í•œ ë³€ìˆ˜ëª…ê³¼ í•¨ìˆ˜ëª…ì´ ë™ì¼í•˜ë©´ ì•ˆëœë‹¤!!
      let phone=signupForm.phone.value;
      if(!phone){
        phoneMsg.innerText="í•¸ë“œí° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”";
        phoneMsg.classList.add("error");
        phoneMsg.classList.remove("success");
        return false;
      }else{
        phoneMsg.innerText="";
        phoneMsg.classList.remove("error");
        return true;
      }
    }

    function uemailCheck(){
      let email=signupForm.email.value;
      if(!email){
        emailMsg.innerText="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”";
        emailMsg.classList.add("error");
        emailMsg.classList.remove("success");
        return false;
      }else{
        emailMsg.innerText="";
        emailMsg.classList.remove("error");
        return true;
      }
    }



  </script>

</main>
</body>
</html>